# Jus Team PDF Converter

[English](./README.md) | 中文版

这是一个专为法律文档设计的 PDF 转 Markdown 工具，旨在将复杂的法律文本转换为清晰、易读且结构化的 Markdown 格式。

## 🌟 核心功能

- **对照校对与在线编辑**: 分屏预览模式支持左侧 PDF 右侧 Markdown 对照，可直接编辑 OCR 结果并同步下载。
- **智能文档导航**: 自动生成文档目录 (TOC)，支持点击跳转，大幅提升长文档阅读与校对效率。
- **法律文档优化**: 针对法律协议、判决书等文档深度优化，自动识别并清理页眉、页脚和页码，保持正文连贯性。
- **智能润色 (双引擎)**: 集成 Mistral 大语言模型对 OCR 结果进行二次处理，自动合并断行、修正格式，并识别“签字/盖章”等法律元素生成语义化标签。
- **批量排序与合并下载**: 支持自定义顺序合并多个转换结果，并自动执行**代码块剥离优化**，纯前端处理，不经过后端，确保输出文档整洁。
- **异步处理能力**: 后台异步 OCR 处理，支持任务持久化。引入**取件码系统**，可在不同设备或会话中找回任务进度。
- **大文件自动分割**: 前端自动识别超过 20MB 的 PDF 文件并进行物理分割，确保在常规模式下即便开启智能润色也能稳定处理不超时。
- **隐私与性能并重**: API Key 仅存储于本地，支持大文件直传 Mistral API，绕过 Worker 限制，确保数据流转安全透明。

## 📍 版本记录

### v4.0.0 (当前版本)
- **对照校对模式**: 新增分屏预览功能，支持左侧查看原始 PDF，右侧查看 OCR 结果，方便进行逐字校对。
- **文档目录导航**: 自动生成文档目录 (TOC) 侧边栏，支持点击标题快速跳转，极大提升长文档的阅读效率。
- **在线编辑**: 用户现可直接在预览窗口中编辑 OCR 结果，所做的修改将同步保存到最终下载的文件中。
- **表格渲染增强**: 集成 `remark-gfm` 插件，完美修复了 Markdown 表格的显示问题。

### v3.8.0
- **纯净 OCR 模式**: 移除了“双引擎智能润色”功能，专注于快速、稳定的高保真 OCR 转换。
- **后端轻量化**: 剔除了 Cloudflare Worker 中与 LLM 相关的服务代码，减少 Worker 体积并消除了同步连接超时风险。
- **阈值恢复**: 将 PDF 自动分割阈值恢复至 **50MB**，支持更大文件的一次性处理。

### v3.7.2
- **分割阈值优化**: 将 PDF 自动分割阈值从 50MB 降低至 **20MB**。这主要是为了应对在开启“双引擎智能润色”时，由于长文处理耗时较长可能导致的 Cloudflare Worker 同步连接超时（30s）问题，显著提升常规模式在大文件场景下的稳定性。

### v3.7.0
- **大模型引擎升级**: 润色引擎从 `ministral-3b` 升级至更强大的 `ministral-14b-2512`，显著提升了法律文档处理的理解能力和格式修复的精准度。
- **长文忠实性优化 (分块处理)**: 实现了智能文本分块逻辑，将长文档拆分为微块进行并发或顺序处理，彻底解决了大模型在处理长文时可能出现的“偷懒”归纳或省略原文的问题。
- **安全性增强建议**: 智能润色功能现在默认保持“关闭”状态，并增加了明确的风险提示，建议用户在需要处理极高完整性要求的长篇法律原文时谨慎使用。
- **严苛忠实性指令**: 重构了 LLM 系统提示词，引入严苛约束，确保输出内容 100% 忠于 OCR 原文。

### v3.6.0
- **PDF 自动分割**: 针对超过 50MB 的超大文件，前端现在会自动将其拆分为多个部分（如 `<文件名>_part1.pdf`）。这绕过了 Mistral API 的单文件大小限制，同时保持了“前端直连”的纯净架构。

### v3.5.1
- **纯净 Markdown 导出**: 自动检测并剥离 OCR 结果中可能出现的 ` ```markdown ` 或 ` ``` ` 代码块包裹。该优化涵盖了单文件下载、文本复制以及批量合并导出的所有路径，确保输出结果为纯净、可直接使用的 Markdown 原文。

### v3.5.0
- **批量排序与合并下载**: 实现了强大的纯前端文件合并系统。用户可以选择多个已完成的任务，在浮动队列面板中手动调整顺序，并一键合并为以分割线（`---`）分隔的单个文档。
- **UI 架构迭代**: 模块化了普通模式与异步模式下的多选逻辑，支持跨任务、跨模式的文件勾选与合并。
- **系统优化与稳定性**: 针对复杂的合并队列状态管理进行了深度优化，提升在多任务并行下的操作流畅度。

### v3.2.0
- **双引擎架构方案**: 引入了 Mistral 大语言模型（`ministral-3b-2512`）作为二次处理引擎，与核心 OCR 深度协同。
- **智能润色开关**: 前端新增“双引擎智能润色”开关，支持自动修复格式错误并根据上下文生成图片描述。
- **法律语义识别**: 针对法律文书场景，大模型可自动识别“签字”、“盖章”、“身份证”等元素，将通用的占位符替换为 `![Signature/Seal]` 或 `![ID Card]` 等语义化标签。
- **高级排版优化**: 自动合并非正常断行的段落，智能移除残留的页眉页脚，确保 Markdown 输出更加整洁。

### v3.0.0
- **实时上传进度反馈**: 引入了基于 `XMLHttpRequest` 的上传进度监听，在直传 Mistral （mistral-ocr） 的过程中提供实时进度条反馈，优化大文件上传体验。
- **增强队列管理**: 支持用户手动移除队列中的单个文件或一键清空任务，操作更加灵活可控。
- **任务历史持久化**: 深度集成**取件码（Access Code）**与本地存储，实现跨会话的任务记录持久化，刷新页面即可找回近期任务。
- **界面交互优化**: 升级了文件列表视觉效果，涵盖更丰富的状态标识和更直观的操作工具栏。

### v2.3.0
- **稳健性增强**: 实现了支持 `Retry-After` 的智能重试逻辑（涵盖前端直传与后端调用），有效应对 Mistral API 的频率限制（429）。
- **类型安全升级**: 前后端 TypeScript 类型定义完全同步，大幅减少运行时潜在错误。
- **错误反馈优化**: 细化了错误提示，区分网络问题、频率限制及 API 验证错误，提供更友好的用户指引。

### v2.2.0
- **后端模块化架构**: 将 Cloudflare Worker 重构为更具可扩展性的模块化结构 (`routes`, `services`, `utils`)，提升代码可维护性。
- **统一 API 客户端**: 前端引入统一的 Mistral API 交互中心，消除代码冗余并确保不同处理模式下的逻辑一致性。
- **系统稳定性增强**: 前后端均引入了自动重试机制，有效应对 Mistral API 的偶发性 500 错误或 429 频率限制。
- **大文件优化**: 进一步优化了前端 `FormData` 的构建方式及网络传输逻辑，提升了 30MB+ 大文件的上传成功率。

### v2.1.0
- **Mistral 直传模式**: 实现了前端直接上传文件至 Mistral API，绕过 Cloudflare Worker 的内存限制，解决了大文件导致的 OOM 错误。
- **架构升级**: Worker 现在直接接收 `mistral_file_id` 进行处理，提升了系统的稳定性和传输速度。
- **错误处理增强**: 优化了上传和处理阶段的错误捕获逻辑，提升了异常情况下的用户体验。

### v2.0.0
- **异步处理与取件码**: 引入持久化任务系统。用户获得 6 位“取件码”，可随时在其他设备或刷新页面后取回后台任务结果。
- **UI 全面中文化**: 针对中文语境完成全界面语言优化。
- **模式优化**: 将处理模式重命名为“常规模式”与“异步模式”，并增加了详细的功能与定价说明。
- **布局重构**: 将数据安全提示移至页脚，并优化了整体视觉宽度对齐，使界面更加整洁。
- **Bug 修复**: 解决了 Mistral 422 上传错误，并优化了任务状态追踪逻辑。

### v1.2.0
- **高性能上传模式**: 彻底重构了文件处理引擎，从 Base64 编码转向 **Signed URL 模式**。
- **支持更大文件**: 显著提升了处理大文件时的稳定性和速度，完美匹配 Mistral 50MB 的 API 上限。
- **内存优化**: 将 Cloudflare Worker 的内存占用降低了 90% 以上。

### v1.1.0
- **隐私合规升级**: 新增详细的数据安全与流转公告，明确告知用户 PDF 文件将上传至 Mistral （mistral-ocr）（欧盟服务器）进行处理。
- **UI 体验优化**: 修复了空状态下的布局对齐问题，优化了提示文案的视觉层级。

### v1.0.0
- **初始发布**: 建立完整的前后端通信链路。
- **自动对齐布局**: 针对不同尺寸浏览器优化的居中布局系统。
- **批量任务引擎**: 稳定支持多文件上传与状态同步。
- **Mistral OCR 集成**: 深度适配 Mistral （mistral-ocr） 最新 OCR 能力。
- **Jus Team 品牌化**: 完成 Jus Team 全套视觉系统集成。

## 🛠 技术架构

该系统由两个主要部分组成：

1.  **Frontend (legal-ocr-frontend)**: 
    - 框架: React + Vite
    - 样式: Tailwind CSS v4
    - 关键特性: 响应式设计、批量任务管理、本地密钥加密管理。

2.  **Worker (legal-ocr-worker)**:
    - 平台: Cloudflare Workers
    - API: Cloudflare Document Intelligence / Mistral OCR
    - 关键特性: 无状态处理、CORS 支持、自动分块处理法律文本。

## 🚀 快速开始

### 1. 克隆项目
```bash
git clone <repository-url>
cd OCR
```

### 2. 部署 Backend (Worker)
```bash
cd legal-ocr-worker
npm install
npm run deploy  # 部署到 Cloudflare
```
部署完成后，记下 Worker URL。

### 3. 运行 Frontend
```bash
cd ../legal-ocr-frontend
npm install
# 在 .env 文件或环境变量中配置 VITE_WORKER_URL
echo "VITE_WORKER_URL=https://your-worker.your-name.workers.dev" > .env
npm run dev
```

## 🔒 数据隐私与安全性 (Data Privacy & Transparency)

本项目采用透明且合规的数据流转方案，确保您的专业文档在转换过程中的高度安全性：

### 1. 数据流转说明
- **API 密钥流转**: 您的 Mistral API 密钥仅存储在浏览器本地（LocalStorage），转换时通过加密通道传递给 Cloudflare Worker 调用，**Jus Team 的任何后端服务器都不会接触或存储您的密钥**。
- **文档流转路径**: PDF 文件自您拖拽上传起，通过 Cloudflare Worker 进行高性能内存中转（不缓存、不落盘），直接流转至 Mistral （mistral-ocr） 官方 OCR 并进行处理。

### 2. 服务器位置与合规
- **后端引擎**: 核心 OCR 逻辑由法国人工智能公司 **Mistral （mistral-ocr）** 提供。请注意，您的文档将上传至 Mistral （mistral-ocr） 的服务器进行识别处理。
- **数据驻留**: Mistral （mistral-ocr） 的服务器主要位于 **欧盟（EU）** 境内。如果您的机构有严格的数据出境限制（例如法律文档不得离开中国大陆或特定国家），请在评估后谨慎使用。

### 3. 透明度承诺
- 本项目不设任何持久化存储数据库。
- 后端代码及流转逻辑完全透明。
- 转换完成后，Worker 将立即清除所有内存中的残留数据。

## 📄 许可证 (License)

本项目采用 **MIT License**。

版权所有 (c) 2026 **Zane**。有关详细信息，请参阅 [LICENSE.md](./LICENSE.md) 文件。
